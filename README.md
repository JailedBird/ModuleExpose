# ModuleExpose

é¡¹ç›®åœ°å€ï¼š[https://github.com/JailedBird/ModuleExpose](https://github.com/JailedBird/ModuleExpose)

## åºè¨€

Androidæ¨¡å—åŒ–å¿…é¡»è¦è§£å†³çš„é—®é¢˜æ˜¯ *å¦‚ä½•å®ç°æ¨¡å—é—´é€šä¿¡* ï¼Ÿè€Œæ¨¡å—ä¹‹é—´é€šä¿¡å¾€å¾€éœ€è¦è·å–ç›¸åŒçš„å®ä½“ç±»å’Œæ¥å£ï¼Œé€ æˆéƒ¨åˆ†æ¶‰åŠæ¨¡å—é€šä¿¡çš„æ¥å£å’Œå®ä½“ç±»è¢«è¿«ä¸‹æ²‰åˆ°åŸºç¡€æ¨¡å—ï¼Œå¯¼è‡´ åŸºç¡€æ¨¡å—ä»£ç è†¨èƒ€ã€æ¨¡å—ä»£ç åˆ†æ•£å’Œä¸ä¾¿ç»´æŠ¤ç­‰é—®é¢˜ï¼›



ModuleExposeæ–¹æ¡ˆä½¿ç”¨æ¨¡å—æš´éœ²&ä¾èµ–æ³¨å…¥æ¡†æ¶Hiltçš„æ–¹å¼ï¼Œå®ç°æ¨¡å—é—´é€šä¿¡ï¼š

- ä½¿ç”¨æ¨¡å—æš´éœ²ï¼ˆæ¨¡å—apiåŒ–ï¼‰è§£å†³åŸºç¡€æ¨¡å—ä¸‹æ²‰é—®é¢˜
- ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶Hiltå®ç°åŸºäºæ¥å£çš„æ¨¡å—è§£è€¦æ–¹æ¡ˆ

## ç®€ä»‹

ModuleExposeï¼Œæ˜¯å°†moduleå†…éƒ¨éœ€è¦æš´éœ²çš„ä»£ç é€šè¿‡è„šæœ¬è‡ªåŠ¨æš´éœ²å‡ºæ¥ï¼›ä¸åŒäºæ‰‹åŠ¨å½¢å¼çš„æ¥å£ä¸‹æ²‰ï¼ŒModuleExposeæ˜¯ç›´æ¥å°†moduleä¸­éœ€è¦æš´éœ²çš„ä»£ç å®Œæ•´æ‹·è´åˆ°module_exposeæ¨¡å—ï¼Œè€Œmodule_exposeæ¨¡å—çš„ç”Ÿæˆã€æ‹·è´å’Œé…ç½®æ˜¯ç”±ModuleExposeè„šæœ¬è‡ªåŠ¨å®Œæˆï¼Œå¹¶ä¿è¯ç¼–è¯‘æ—¶ä¸¤è€…ä»£ç çš„å®Œå…¨åŒæ­¥ï¼›



æœ€ç»ˆï¼Œå·¥ç¨‹ä¸­åŒ…å«å¦‚ä¸‹å‡ ç±»æ ¸å¿ƒæ¨¡å—ï¼š

- åŸºç¡€æ¨¡å—ï¼šåŸºç¡€ä»£ç å°è£…ï¼Œå¯ä¾›ä»»ä½•ä¸šåŠ¡æ¨¡å—ä½¿ç”¨ï¼›

- ä¸šåŠ¡æ¨¡å—ï¼šåŒ…å«ä¸šåŠ¡åŠŸèƒ½ï¼Œä¸šåŠ¡æ¨¡å—å¯ä»¥ä¾èµ–åŸºç¡€æ¨¡å—ï¼Œä½†æ— æ³•ä¾èµ–å…¶ä»–ä¸šåŠ¡æ¨¡å—ï¼ˆé¿å…å¾ªç¯ä¾èµ–ï¼‰ï¼›
- æš´éœ²æ¨¡å—ï¼šç”±è„šæœ¬åŸºäºä¸šåŠ¡æ¨¡å—æˆ–åŸºç¡€æ¨¡å—è‡ªåŠ¨æ‹·è´ç”Ÿæˆï¼Œä¸šåŠ¡æ¨¡å—å¯ä¾èµ–å…¶ä»–æš´éœ²æ¨¡å—ï¼ˆé€šè¿‡compileOnlyæ–¹å¼ï¼Œåªå‚ä¸ç¼–è¯‘ä¸å‚ä¸æ‰“åŒ…ï¼‰ï¼Œé¿å…æ¨¡å—é€šä¿¡æ‰€éœ€çš„æ¥å£ã€æ•°æ®å®ä½“ç±»ä¸‹æ²‰åˆ°åŸºç¡€æ¨¡å—ï¼Œé€ æˆåŸºç¡€æ¨¡å—è†¨èƒ€ã€ä¸šåŠ¡æ¨¡å—æ ¸å¿ƒç±»åˆ†æ•£åˆ°åŸºç¡€æ¨¡å—ç­‰é—®é¢˜ï¼›



æ³¨æ„è¿™ç§æ–¹æ¡ˆå¹¶éåŸåˆ›ï¼ŒåŸåˆ›å‡ºå¤„å¦‚ä¸‹ï¼š

æ€è·¯åŸåˆ›ï¼š[å¾®ä¿¡Androidæ¨¡å—åŒ–æ¶æ„é‡æ„å®è·µ](https://mp.weixin.qq.com/s/6Q818XA5FaHd7jJMFBG60w)

> å…ˆå¯»æ‰¾ä»£ç è†¨èƒ€çš„åŸå› ã€‚
>
> ç¿»å¼€åŸºç¡€å·¥ç¨‹çš„ä»£ç ï¼Œæˆ‘ä»¬çœ‹åˆ°é™¤äº†ç¬¦åˆè®¾è®¡åˆè¡·çš„å­˜å‚¨ã€ç½‘ç»œç­‰æ”¯æŒç»„ä»¶å¤–ï¼Œè¿˜æœ‰ç›¸å½“å¤šçš„ä¸šåŠ¡ç›¸å…³ä»£ç ã€‚è¿™äº›ä»£ç æ˜¯è†¨èƒ€çš„æ¥æºã€‚ä½†ä»£ç æ€ä¹ˆæ¥çš„ï¼Œéè¦æ”¾è¿™ï¼Ÿä¸€åˆ‡ä¸åˆç†çš†æœ‰èƒŒåçš„é€»è¾‘ã€‚åœ¨ä¹‹å‰çš„æ¶æ„ä¸­ï¼Œæˆ‘ä»¬å¤§é‡ä½¿ç”¨Eventäº‹ä»¶æ€»çº¿ä½œä¸ºæ¨¡å—é—´é€šä¿¡çš„æ–¹å¼ï¼Œä¹ŸåŸºæœ¬æ˜¯å”¯ä¸€çš„æ–¹å¼ã€‚ä½¿ç”¨Eventä½œä¸ºé€šä¿¡çš„åª’ä»‹ï¼Œè‡ªç„¶è¦æœ‰å®šä¹‰å®ƒçš„åœ°æ–¹ï¼Œå¥½è®©æ¨¡å—ä¹‹é—´éƒ½èƒ½çŸ¥é“Eventç»“æ„æ˜¯æ€æ ·çš„ã€‚è¿™æ—¶å€™åŸºç¡€å·¥ç¨‹å¥½åƒå°±æˆäº†å­˜æ”¾Eventçš„å”¯ä¸€é€‰æ‹©â€”â€”Eventå®šä¹‰è¢«æ”¾åœ¨åŸºç¡€å·¥ç¨‹ä¸­ï¼›æ¥ç€ï¼Œé‡åˆ°æŸä¸ªæ¨¡å—Aæƒ³ä½¿ç”¨æ¨¡å—Bçš„æ•°æ®ç»“æ„ç±»ï¼Œæ€ä¹ˆåŠï¼ŸæŠŠç±»ä¸‹æ²‰åˆ°åŸºç¡€å·¥ç¨‹ï¼›é‡åˆ°æ¨¡å—Aæƒ³ç”¨æ¨¡å—Bçš„æŸä¸ªæ¥å£è¿”å›ä¸ªæ•°æ®ï¼ŒEventå¥½åƒä¸å¤ªé€‚åˆï¼Ÿé‚£å°±æŠŠä»£ç ä¸‹æ²‰åˆ°åŸºç¡€å·¥ç¨‹å§â€¦â€¦
>
> å°±è¿™æ ·è¶Šæ¥è¶Šå¤šçš„ä»£ç å¾ˆâ€œè‡ªç„¶çš„â€è¢«ä¸‹æ²‰åˆ°åŸºç¡€å·¥ç¨‹ä¸­ã€‚
>
> 
>
> implementationå·¥ç¨‹æä¾›é€»è¾‘çš„å®ç°ã€‚apiå·¥ç¨‹æä¾›å¯¹å¤–çš„æ¥å£å’Œæ•°æ®ç»“æ„ã€‚libraryå·¥ç¨‹ï¼Œåˆ™æä¾›è¯¥æ¨¡å—çš„ä¸€äº›å·¥å…·ç±»ã€‚



é¡¹ç›®åŸåˆ›:  [github/tyhjh/module_api](https://github.com/tyhjh/module_api)

> å¦‚æœæ¯æ¬¡æœ‰ä¸€ä¸ªæ¨¡å—è¦ä½¿ç”¨å¦ä¸€ä¸ªæ¨¡å—çš„æ¥å£éƒ½æŠŠæ¥å£å’Œç›¸å…³æ–‡ä»¶æ”¾åˆ°å…¬å…±æ¨¡å—é‡Œé¢ï¼Œé‚£ä¹ˆå…¬å…±æ¨¡å—ä¼šè¶Šæ¥è¶Šå¤§ï¼Œè€Œä¸”æ¯ä¸ªæ¨¡å—éƒ½ä¾èµ–äº†å…¬å…±æ¨¡å—ï¼Œéƒ½ä¾èµ–äº†ä¸€å¤§å †å¯èƒ½ä¸éœ€è¦çš„ä¸œè¥¿ï¼›
>
> æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æå–å‡ºæ¯ä¸ªæ¨¡å—æä¾›apiçš„æ–‡ä»¶æ”¾åˆ°å„ç§å•ç‹¬çš„æ¨¡å—é‡Œé¢ï¼›æ¯”å¦‚useræ¨¡å—ï¼Œæˆ‘ä»¬æŠŠå…¬å…±æ¨¡å—é‡Œé¢çš„Userå’ŒUserInfoServiceæ”¾åˆ°æ–°çš„user-apiæ¨¡å—é‡Œé¢ï¼Œè¿™æ ·å…¶ä»–æ¨¡å—ä½¿ç”¨çš„æ—¶å€™å¯ä»¥å•ç‹¬ä¾èµ–äºè¿™ä¸ªä¸“é—¨æä¾›æ¥å£çš„æ¨¡å—ï¼Œä»¥æ­¤è§£å†³å…¬å…±æ¨¡å—è†¨èƒ€çš„é—®é¢˜



æœ¬äººå·¥ä½œï¼š

- ä½¿ç”¨ktså’Œnioé‡å†™è„šæœ¬ï¼ŒåŸºäºæ€§èƒ½çš„è€ƒé‡ï¼Œå¯¹æš´éœ²è§„åˆ™å’Œç”Ÿæˆæ–¹å¼è¿›è¡Œæ”¹è¿›ï¼›
- å°†[nowinandroid](https://github.com/android/nowinandroid)é¡¹ç›®ç¼–è¯‘è„šæœ¬ç³»ç»Ÿã€Kspç‰ˆæœ¬çš„Hiltä¾èµ–æ³¨å…¥æ¡†æ¶ã€ç¤ºä¾‹å·¥ç¨‹ä¸‰è€…ç»“åˆèµ·æ¥ï¼Œå®Œå–„åŸºäº *æ¨¡å—æš´éœ²&ä¾èµ–æ³¨å…¥æ¡†æ¶* çš„æ¨¡å—è§£è€¦ç¤ºä¾‹å·¥ç¨‹ï¼›
- å°†apiæ”¹åexposeï¼ˆPSï¼šå› å†…éƒ¨é¡¹ç›®ä½¿ç”¨è¿‡ä¹‹å‰çš„apiæ–¹æ¡ˆï¼Œä¸ºé¿å…å†²çªæ‰€ä»¥æ”¹åï¼Œä¹Ÿé¿å…å’Œå¤§ä½¬é¡¹ç›®åå­—å†²çªğŸ˜˜ è„šæœ¬ä¸­äº¦å¯è‡ªå®šä¹‰å…³é”®è¯ï¼‰



æœ¯è¯­è¯´æ˜ï¼š

- [éƒ¨åˆ†åšå®¢](https://juejin.cn/post/6945413567285821453)ä¸­ç§°è¿™ç§æ–¹å¼ä¸º***æ¨¡å—apiåŒ–***ï¼Œæˆ‘è§‰å¾—è¿™æ˜¯åˆç†çš„ï¼›æœ¬æ–‡çš„è¯­å¢ƒä¸­çš„exposeå’Œapiæ˜¯ç­‰ä»·çš„æ„æ€ï¼›




## æ¨¡å—æš´éœ²

**1ã€é¡¹ç›®å¯ç”¨ktsé…ç½®**

å› ä¸ºè„šæœ¬ä½¿ç”¨ktsç¼–å†™ï¼Œå› æ­¤éœ€è¦åœ¨é¡¹ç›®ä¸­å¯ç”¨ktsé…ç½®ï¼›å¦‚å› ä¸ºgradleç‰ˆæœ¬è¿‡ä½ç­‰åŸå› å¯¼è‡´æ— æ³•æ¥å…¥ktsï¼Œé‚£åº”è¯¥æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼›åç»­é»˜è®¤éƒ½å¼€å¯ktsï¼Œå¹¶ä½¿ç”¨ktsè¯­æ³•è„šæœ¬ï¼›



**2ã€å¯¼å…¥è„šæœ¬åˆ°gradleç›®å½•&ä¿®æ”¹æ¨¡æ¿**

è¯·æ‹·è´ç¤ºä¾‹å·¥ç¨‹`gradle/expose`ç›®å½•åˆ°ä¸ªäººé¡¹ç›®gradleç›®å½•ï¼Œæ‹·è´åç›®å½•å¦‚ä¸‹ï¼š

```
Path
ModuleExpose\gradle

gradle
â”‚  libs.versions.toml
â”œâ”€expose
â”‚      build_gradle_template_android
â”‚      build_gradle_template_java
â”‚      build_gradle_template_expose
â”‚      expose.gradle.kts
â””â”€wrapper
        gradle-wrapper.jar
        gradle-wrapper.properties
```

å…¶ä¸­ï¼šexpose.gradle.ktsæ˜¯æ¨¡å—æš´éœ²çš„æ ¸å¿ƒè„šæœ¬ï¼ŒåŒ…å«è‹¥å¹²å‡½æ•°å’Œé…ç½®å‚æ•°ï¼›

å…¶ä¸­ï¼šbuild_gradle_template_androidå’Œbuild_gradle_template_javaè„šæœ¬æ¨¡æ¿å› é¡¹ç›®ä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œéœ€è¦è‡ªè¡Œæ ¹æ®é¡¹ç›®ä¿®æ”¹ï¼Œå¦åˆ™æ— æ³•ç¼–è¯‘ï¼›

- build_gradle_template_androidï¼Œç”ŸæˆAndroidæ¨¡å—çš„è„šæœ¬æ¨¡æ¿ï¼Œæ³¨æ„é«˜ç‰ˆæœ¬gradleå¿…é¡»é…ç½®namespaceï¼Œå› æ­¤æœ€å¥½ä¿ç•™å¦‚ä¸‹çš„é…ç½®ï¼ˆç»†åˆ™è§è„šæœ¬å¦‚ä½•å¤„ç†çš„ï¼‰ï¼š

  ```
  android {
      namespace = "%s"
  }
  ```

- build_gradle_template_javaï¼Œ ç”ŸæˆJavaæ¨¡å—çš„è„šæœ¬æ¨¡æ¿ï¼Œé…ç½®è¾ƒä¸ºç®€å•ï¼›

- includeWithApiå‡½æ•°ä½¿ç”¨build_gradle_template_androidæ¨¡æ¿ç”ŸæˆAndroid Libraryæ¨¡å—

- includeWithJavaApiå‡½æ•°ä½¿ç”¨build_gradle_template_javaæ¨¡æ¿ç”ŸæˆJava Libraryæ¨¡å—

- build_gradle_template_exposeï¼Œä¸åŒäºbuild_gradle_template_androidã€build_gradle_template_javaçš„æ¨¡æ¿å½¢å¼çš„é…ç½®ï¼Œä½¿ç”¨includeWithApiã€includeWithJavaApiæ—¶ï¼Œ**ä¼šä¼˜å…ˆæ£€æŸ¥æ¨¡å—æ ¹ç›®å½•æ˜¯å¦å­˜åœ¨build_gradle_template_expose**ï¼Œå¦‚æœå­˜åœ¨åˆ™**ä¼˜å…ˆã€ç›´æ¥**å°†build_gradle_template_exposeå†…å®¹æ‹·è´åˆ°module_expose, ä½œä¸ºbuild.gradle.kts ï¼ **ä¿ç•™è¿™ä¸ªé…ç½®çš„åŸå› åœ¨äºï¼šå¦‚æœéœ€è¦æš´éœ²çš„ç±»ï¼Œå¼•ç”¨ä¸‰æ–¹ç±»å¦‚gsonã€ä½†ä¸ä¾¿å°†ä¸‰æ–¹åº“implementationåˆ°build_gradle_template_androidï¼Œè¿™ä¼šå¯¼è‡´module_exposeç¼–è¯‘æŠ¥é”™ï¼Œå› æ­¤ä¸ºè§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œæœ€å¥½ä½¿ç”¨è‡ªå®šä¹‰module_exposeè„šæœ¬ï¼ˆæ‹·è´moduleçš„é…ç½®ã€ç¨åŠ ä¿®æ”¹å³å¯ï¼‰**

  PSï¼šæ³¨æ„è¿™å‡ ä¸ªæ¨¡æ¿éƒ½æ˜¯æ— åç¼€çš„ï¼Œktsåç¼€æ–‡ä»¶ä¼šè¢«IDEæç¤ºä¸€å¤§å †ä¸œè¥¿ï¼›

**æ³¨æ„ï¼š** Javaæ¨¡å—ç¼–è¯‘æ›´å¿«ï¼Œä½†æ˜¯ç¼ºå°‘Activityã€Contextç­‰Androidç¯å¢ƒï¼Œè¯·çµæ´»ä½¿ç”¨ï¼›å½“ç„¶æœ€çµæ´»çš„æ–¹å¼æ˜¯ä¸ºæ¯ä¸ªmodule_exposeå•ç‹¬é…ç½®build_gradle_template_expose ï¼ˆç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼‰ï¼›å¦å¤–ï¼Œå¦‚æœä¸ç”¨includeWithJavaApiï¼Œå…¶å®build_gradle_template_javaä¹Ÿæ˜¯ä¸éœ€è¦çš„ï¼›



**3ã€settings.gradle.ktså¯¼å…¥è„šæœ¬å‡½æ•°**

æ ¹ç›®å½•settings.gradle.ktsé…ç½®å¦‚ä¸‹ï¼š

```
apply(from = "$rootDir/gradle/expose/expose.gradle.kts")
val includeWithApi: (projectPaths: String) -> Unit by extra
val includeWithJavaApi: (projectPaths: String) -> Unit by extra
```

ï¼ˆPSï¼šåªè¦æ­£ç¡®å¯ç”¨ktsï¼Œsettings.gradleåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å¯¼å…¥includeWithApiçš„ï¼Œä½†æ˜¯æˆ‘æ²¡å°è¯•ï¼›å…¶æ¬¡è€é¡¹ç›®é’ˆå¯¹ModuleExposeæ”¹é€ ktsæ—¶ï¼Œå¯ä»¥æ¸è¿›å¼æ”¹é€ ï¼Œå³åªæ”¹settings.gradle.ktså³å¯ï¼‰



**4ã€æ¨¡å—é…ç½®**

å°†éœ€è¦æš´éœ²çš„æ¨¡å—ï¼Œåœ¨settings.gradle.kts ä½¿ç”¨includeWithApiï¼ˆæˆ–includeWithJavaApiï¼‰å¯¼å…¥ï¼›

```
includeWithApi(":feature:settings")
includeWithApi(":feature:search")
```

å³å¯è‡ªåŠ¨ç”Ÿæˆæ–°æ¨¡å— `${module_expose}`ï¼›ç„¶ååœ¨æ¨¡å—æºç ç›®å½•ä¸‹åˆ›å»ºåä¸ºexposeçš„ç›®å½•ï¼Œå°†éœ€è¦æš´éœ²çš„æ–‡ä»¶æ”¾åœ¨exposeç›®å½•ä¸‹ï¼Œ exposeç›®å½•ä¸‹çš„æ–‡ä»¶å³å¯åœ¨æ–°æ¨¡å—ä¸­è‡ªåŠ¨æ‹·è´ç”Ÿæˆï¼›

ç”Ÿæˆç»†åˆ™ï¼š

1ã€ æ¨¡å—æ”¯æŒå¤šä¸ªexposeç›®å½•ï¼ˆé€’å½’ã€å«å­ç›®å½•ï¼‰åŒæ—¶æš´éœ²ï¼Œè¿™å¯ä»¥é¿å…å°†å®ä½“ç±»ï¼Œæ¥å£ç­‰å…¨éƒ¨æ”¾åœ¨å•ä¸ªexposeï¼Œçœ‹ç€å¾ˆä¹±

2ã€ exposeå†…éƒ¨çš„æ–‡ä»¶ï¼Œé»˜è®¤å…¨éƒ¨å¤åˆ¶ï¼Œä½†è„šæœ¬æä¾›äº†å¼€å…³ï¼Œå¯ä»¥è‡ªè¡Œæ›´æ”¹å¹¶é…ç½®åŸºäºæ–‡ä»¶åçš„æ‹·è´è¿‡æ»¤ï¼›



**5ã€ä½¿ç”¨module_exposeæ¨¡å—**

è¯·ä½¿ç”¨ `compileOnly` å¯¼å…¥é¡¹ç›®ï¼Œå¦‚ä¸‹ï¼š

```
compileOnly(project(mapOf("path" to ":feature:search_expose")))
```

é”™è¯¯ï¼šä¼šå¯¼è‡´èµ„æºå†²çª

```
implementation(project(mapOf("path" to ":feature:search_expose")))
```

åŸç†è§£é‡Šï¼šcompileOnlyåªå‚ä¸ç¼–è¯‘ï¼Œä¸ä¼šè¢«æ‰“åŒ…ï¼›implementationå‚ä¸ç¼–è¯‘å’Œæ‰“åŒ…ï¼›

å› æ­¤search_exposeåªèƒ½ä½¿ç”¨compileOnlyå¯¼å…¥ï¼Œç¡®ä¿è§£è€¦çš„æ¨¡å—ä¹‹é—´å¯ä»¥è®¿é—®åˆ°ç±»å¼•ç”¨ï¼Œä½†ä¸ä¼šé€ æˆæ‰“åŒ…æ—¶2ä¸ªç±»ç›¸åŒçš„å†²çªé—®é¢˜ï¼›



## ä¾èµ–æ³¨å…¥

**åŸºäºæ¨¡å—æš´éœ²çš„ç›¸å…³æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶Hiltå®ç°åŸºäºæ¥å£çš„è§£è€¦ï¼›** å½“ç„¶å¦‚æœå¤§å®¶ä¸ä½¿ç”¨HiltæŠ€æœ¯æ ˆçš„è¯ï¼Œè¿™èŠ‚å¯ä»¥è·³è¿‡ï¼›

æœ¬èŠ‚å†…å®¹ä¼šä»¥ä¸šåŠ¡æ¨¡å—searchå’Œsettingsä¸ºä¾‹ï¼Œé€šè¿‡ä»£ç å±•ç¤ºï¼š

- searchæ¨¡å—è·³è½¬åˆ°settingsæ¨¡å—ï¼Œæ‰“å¼€SettingsActivity
- settingsæ¨¡å—è·³è½¬åˆ°searchæ¨¡å—ï¼Œæ‰“å¼€SearchActivity



PSï¼šå…³äºHiltçš„é…ç½®å’Œå¯¼å…¥ï¼Œæœ¬é¡¹ç›®ç›´æ¥æ²¿ç”¨nowinandroidå·¥ç¨‹ä¸­build-logicçš„é…ç½®ï¼Œå…·ä½“é…ç½®å’Œä½¿ç”¨è¯·å‚è€ƒæœ¬é¡¹ç›®å’Œnowinandroidé¡¹ç›®ï¼›



**1ã€ åŸºæœ¬é…ç½®&å·¥ç¨‹ç»“æ„ï¼š**

![image.png](https://zhaojunchen-1259455842.cos.ap-nanjing.myqcloud.com//imgimg1701008044066-f5a578b3-0e3a-4f50-a891-f71333294e65.png)

å¯¼å…¥è„šæœ¬ä¹‹åï¼Œä½¿ç”¨includeWithApiå¯¼å…¥ä¸‰ä¸ªä¸šåŠ¡æ¨¡å—ï¼Œå„è‡ªç”Ÿæˆå¯¹åº”çš„module_exposeï¼›

**æ³¨æ„ï¼Œè¯·å°†`*_expose/`æ·»åŠ åˆ°gitignoreï¼Œé¿å…exposeæ¨¡å—æäº¤åˆ°git**



**2ã€ ä¸šåŠ¡æ¨¡å—æ¥å£æš´éœ²&å®ç°**

settingsæ¨¡å—exposeç›®å½•ä¸‹æš´éœ²`SettingExpose`æ¥å£ï¼Œ è„šæœ¬ä¼šè‡ªåŠ¨å°†å…¶åŒæ­¥æ‹·è´åˆ°settings_exposeä¸­å¯¹åº”exposeç›®å½•

![image.png](https://zhaojunchen-1259455842.cos.ap-nanjing.myqcloud.com//img1701008271448-b0b32e1f-0988-479e-bc16-ba9845414ea7.png)



exposeimpl/SettingExposeImplå®ç°SettingExposeæ¥å£çš„å…·ä½“åŠŸèƒ½ï¼Œå®Œå–„è·³è½¬åŠŸèƒ½

```
class SettingExposeImpl @Inject constructor() : SettingExpose {
    override fun startSettingActivity(context: Context) {
        SettingsActivity.start(context)
    }
}
```



**3ã€ Hiltæ·»åŠ æ³¨å…¥æ¥å£ç»‘å®š**

ä½¿ç”¨Hiltç»‘å®šå…¨å±€å•ä¾‹SettingExposeæ¥å£å®ç°ï¼Œå…¶å¯¹åº”å®ç°ä¸ºSettingExposeImpl

![image.png](https://zhaojunchen-1259455842.cos.ap-nanjing.myqcloud.com//img1701008419851-2d972419-d0bf-4d95-8b24-9c3db6ee5cdb.png)



**4ã€ searchæ¨¡å—compileOnlyå¯¼å…¥settings_expose**

```
compileOnly(projects.feature.settingsExpose)
```

**æ³¨æ„ï¼Œæ¨¡å—æš´éœ²ä¾èµ–åªèƒ½ä½¿ç”¨compileOnly**ï¼Œä¿è¯ç¼–è¯‘æ—¶å€™èƒ½æ‰¾åˆ°å¯¹åº”æ–‡ä»¶å³å¯ï¼›å¦å¤–projects.feature.settingsExposeè¿™ç§é¡¹ç›®å¯¼å…¥æ–¹å¼ï¼Œéœ€è¦åœ¨settings.gradle.ktså¯ç”¨projectç±»å‹å®‰å…¨é…ç½®ï¼›

```
 enableFeaturePreview("TYPESAFE_PROJECT_ACCESSORS")
```



**5ã€ searchæ³¨å…¥å¹¶ä½¿ç”¨SettingExpose**

```
@AndroidEntryPoint
class SearchActivity : AppCompatActivity() {
    @Inject
    lateinit var settingExpose: SettingExpose
    
    private val listener = object : AppSettingsPopWindow.Listener {

        override fun settings() {
            settingExpose.startSettingActivity(this@SearchActivity)
        }
    }
}
```



**6ã€ å®ç°è§£è€¦**

æœ€ç»ˆå®ç°ã€searchæ¨¡å—è·³è½¬åˆ°settingsæ¨¡å—ï¼Œæ‰“å¼€SettingsActivityã€‘ï¼Œ è‡³äºã€settingsæ¨¡å—è·³è½¬åˆ°searchæ¨¡å—ï¼Œæ‰“å¼€SearchActivityã€‘çš„æ“ä½œå®Œå…¨ä¸€è‡´ï¼Œä¸é‡å¤å™è¿°äº†ï¼›







## å‚è€ƒèµ„æ–™

1ã€æ€è·¯åŸåˆ›ï¼š[å¾®ä¿¡Androidæ¨¡å—åŒ–æ¶æ„é‡æ„å®è·µ](https://mp.weixin.qq.com/s/6Q818XA5FaHd7jJMFBG60w)

2ã€é¡¹ç›®åŸåˆ›ï¼š[github/tyhjh/module_api](https://github.com/tyhjh/module_api)

3ã€è„šæœ¬è¿ç§»ï¼š[å°† build é…ç½®ä» Groovy è¿ç§»åˆ° KTS](https://developer.android.com/studio/build/migrate-to-kts?hl=zh-cn)

4ã€å‚è€ƒæ–‡ç« ï¼š[Androidæ¨¡å—åŒ–è®¾è®¡æ–¹æ¡ˆä¹‹æ¥å£APIåŒ–](https://juejin.cn/post/6945413567285821453)

5ã€Nowinandroidï¼š[https://github.com/android/nowinandroid](https://github.com/android/nowinandroid)

6ã€Daggeré¡¹ç›®ï¼š[https://github.com/google/dagger](https://github.com/google/dagger)

7ã€Hiltå®˜æ–¹æ•™ç¨‹ï¼š[https://developer.android.com/training/dependency-injection/hilt-android](https://developer.android.com/training/dependency-injection/hilt-android?hl=zh-cn)











